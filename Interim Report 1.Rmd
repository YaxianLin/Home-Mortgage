---
title: "Interim Report 1"
author: "Yaxian Lin" "Chenlu Jiang"
date: "2018/2/21"
output: word_document
---
The URL for our Team GitHub repository is {https://github.com/YaxianLin/Home-Mortgage.git}. 
The URL to the Kaggle dataset is {https://www.kaggle.com/jboysen/ny-home-mortgage/data}.
The URL to the kernel is {https://www.kaggle.com/ambarish/eda-home-mortgage-ny-with-feature-analysis/notebook}


## Problem Identification
The dataset we have contains all mortgage decisions made in 2015 for the state of New York. The data problems for the dataset are that there are too many potential determined variables for loan origination, some of them have numerous missing data and some of them are repetitive. For our final managerial objective: helping banks to find out what essential variables determine the loan origination, we need to clean, tidy and deal with the data to figure out a reasonable model to solve the problem.


## Data Inspection
```{r warning = FALSE, message = FALSE}
library(ggplot2)
library(dplyr)

Mortgage <-read.csv(file.choose())
ls(Mortgage)
unique(Mortgage$applicant_sex_name)
unique(Mortgage$applicant_sex)
unique(Mortgage$owner_occupancy_name)
```
As you can see, there are 78 variables in the dataset. It is redundant to describe the mearsurement types of all 78 variables. Besides, some of them illustrate the same thing, such as "action_taken" and "action_taken_name". Hence, we will only describe several important variables as examples.  
In general, the 78 variables can be divided into 4 subjects. 
* applicant: ethnicity, race, sex,income level and so on
* lender: agency
* property: property type, occupancy of the property, location of the property and so on
* mortage information: action, amount, lien status, type and purpose

In general, most variables in the data are nominal variables. For example, "action_taken" indicates the 7 different result of loan application. All variables relevant to applicant except "applicant_income_000s", such as race or gender, are nominal variables. "applicant_income_000s" is a ratio scale variabe, showing the incomel level of the applicant. "loan_amount_000s" and "census_tract_number" are also ratio scale variables while "as_of_year" is a rare interval variable in this dataset.

## Table summarizing range in each variable
```{r}
Mortgage <-read.csv(file.choose())
install.packages("pastecs")
library(pastecs)
NumVar <- sapply(Mortgage, is.numeric)
stat.desc(Mortgage[, NumVar])[c("min", "max", "range", "median", "mean"),]
```
As mentioned above, there are 78 variables in this dataset. Only 44 of them are numerical variables. It only makes sense to compute range and other descriptive statistics for numerical variables only. Therefore, subset NumVar is created to contain all numerical variables in the Mortgage dataset. Then the stat.desc function from the pastecs package is used to compute range and other descriptive statistics of variables in subset NumVar. Notably, the stat.desc function computes 14 kinds of statistics and most of them are not necessary in this case. Thus, only min, max, range, median, and mean are included in the table.  

## Missing Data

First for some of the categorical variables using interger as category, we change them into factor. For variables with more than 50% missing data, such as rate_spread, applicant-race_2/3/4/5, denial_reason_1/2/3 etc., we decide to straightly delete them. For numeric variables with some missing data, we decide to use mean value to replace the missing value. Here we use census_tract_number as an example to present. For categorical varibles which have more than two catrgories with some missing data, we decide to use the mode category to replace the missing value. Last for the dummy variables with some missing data, we decide to use "00" meaning unknown to replace the missing value (assuming that dummy labels are "0" and "1").

```{r}
str(Mortgage)
summary(Mortgage)
Mortgage$census_tract_number[is.na(Mortgage$census_tract_number)] = mean(Mortgage$census_tract_number, na.rm = TRUE)
```

## density histogram of action taken on loan
```{r}
library(ggplot2)
library(dplyr)
action= Mortgage %>% group_by(action_taken) %>%
  summarise(count = n()) %>%
  mutate(p = count/sum(count) * 100)

ggplot(action, aes(x =action_taken, y = p)) +
  geom_bar(stat='identity',colour="white")+
  labs(x='action_taken', y='pencenrage',title='mortage action')
```


## density plot for gender
```{r}
Mortgage$gender = "0"
Mortgage$gender[Mortgage$applicant_sex == 1] = "Female"
Mortgage$gender[Mortgage$applicant_sex == 2] = "Male"
Mortgage$gender[Mortgage$applicant_sex == 3] = "Noinfo"
Mortgage$gender[Mortgage$applicant_sex == 4] = "Noapp"
den_gender <- Mortgage %>%
  ggplot(aes(x=gender)) +
  geom_density(alpha=0.5, color="darkblue") +
  ggtitle("density plot for gender") +
  labs(x = "gender")
den_gender
```

## Histogram for Ethnicity
```{r}
Mortgage$applicant_ethnicity[Mortgage$applicant_ethnicity == 1] = "Hispanic or Latino"
Mortgage$applicant_ethnicity[Mortgage$applicant_ethnicity == 2] = "Not Hispanic or Latino"
Mortgage$applicant_ethnicity[Mortgage$applicant_ethnicity == 3] = "Info Not Available"
Mortgage$applicant_ethnicity[Mortgage$applicant_ethnicity == 4] = "Not Applicable"
ethnicity = Mortgage %>% group_by(applicant_ethnicity) %>%
  summarise(count = n()) %>%
  mutate(p = count/sum(count) * 100)
ggplot(ethnicity, aes(x = applicant_ethnicity, y = p)) +
  geom_bar(stat='identity',colour="white")+
  labs(x='applicant ethnicity', y='pencentage',title='Ethnicity of Mortgage Applicants')
```

```{r}
##Income distribution via loan origination
Mortgage$lo <- 'unoriginated'
Mortgage$lo[Mortgage$action_taken_name == 'Loan originated'] <- 'originated'
Mortgage %>%
  ggplot(aes(applicant_income_000s))  +
  geom_histogram(binwidth = 15) +
  facet_wrap(~lo) +
  labs(x = 'Income', y = 'Count', title = 'Income distribution via loan origination ') +
  scale_x_continuous(limits = c(0, 800) )
```

```{r}
Mortgage %>%
  ggplot(aes(loan_amount_000s))  +
  geom_histogram(binwidth = 10) +
  facet_wrap(~lo) +
  labs(x = 'loan amount', y = 'Count', title = 'Loan amount distribution via originated and unoriginated ') +
  scale_x_continuous(limits = c(0, 1000) )
```




